-- INSERT IMPORT (chua run)

create or replace function insert_import_detail()
returns trigger
as
$body$
declare
	maso_CSM character varying(20) = new."ID_CSM";
	maso_Product character varying(20) = new."ID_Product";
	quantity numeric = new."Quantity";
begin
-- 	import
	UPDATE public."Import"
		SET "Quantity" = "Quantity" + quantity
		WHERE "ID_CSM" = maso_CSM;
-- 	warehouse
	UPDATE public."WareHouse"
		SET "Quantity" = "Quantity" + quantity
		WHERE "ID_Product" = maso_Product;
-- 	warehouse detail insert
	INSERT INTO public."WareHouse_detail"(
		"ID_Product", "ID_CSM", "Quantity")
		VALUES (maso_Product,maso_CSM, quantity);
return new;
end;
$body$
language plpgsql;

create or replace trigger check_insert_im
after insert
on "Import_detail"
for each row
execute procedure insert_import_detail();

-- drop trigger if exists check_insert_im on "Import_detail";
-- drop function if exists insert_import_detail();

-- IF
-- do $$
-- declare
-- 	v_lap "Laptop"%rowtype;
-- begin

-- 	select * from "Laptop" 
-- 	into v_lap
-- 	where "Laptop"."ID" = 'L1';
	
-- 	if not found then
-- 		select * from "Laptop" where "Laptop"."ID" = 'L1';
-- 	else
-- 		UPDATE public."WareHouse"
-- 		SET "Quantity"=0
-- 		WHERE "ID_Product" = 'L1';
-- 	end if;
-- end $$

-- select * from "WareHouse"  where "ID_Product"  = 'L1';